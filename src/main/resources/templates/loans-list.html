<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${pageTitle}">Empréstimos Ativos</title>
</head>
<body>

<div th:replace="~{layout :: content}">
    <div th:fragment="content">

        <div class="card">
            <div class="card-body">
                <h2 class="h4 mb-4">Empréstimos Ativos</h2>

                <div th:if="${param.error}" class="alert alert-danger" role="alert">
                    <span th:text="${param.error}">Mensagem de Erro</span>
                </div>
                <div th:if="${param.success}" class="alert alert-success" role="alert">
                    <span th:text="${param.success}">Mensagem de Sucesso</span>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-light">
                        <tr>
                            <th scope="col">Livro</th>
                            <th scope="col">Leitor</th>
                            <th scope="col">Empréstimo</th>
                            <th scope="col">Devolução Prevista</th>
                            <th scope="col" class="text-end">Ações</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="loan : ${loans}">
                            <td th:text="${books.get(loan.bookId()).title()}">Título do Livro</td>
                            <td th:text="${loan.borrowerName()}">Nome do Leitor</td>
                            <td th:text="${#temporals.format(loan.loanDate(), 'dd/MM/yyyy')}">dd/mm/aaaa</td>

                            <td th:classappend="${#temporals.isAfter(T(java.time.LocalDate).now(), loan.loanDate().plusDays(10))} ? 'text-danger fw-bold' : ''">
                                <span th:text="${#temporals.format(loan.dueDate(), 'dd/MM/yyyy')}">dd/mm/aaaa</span>
                                <span th:if="${#temporals.isAfter(T(java.time.LocalDate).now(), loan.loanDate().plusDays(10))}" class="badge bg-danger ms-2">Em Atraso</span>
                            </td>

                            <td class="text-end">
                                <a th:href="@{/return/{id}(id=${loan.id()})}" class="btn btn-sm btn-success">
                                    <i class="bi bi-arrow-return-left"></i> Devolver
                                </a>
                            </td>
                        </tr>

                        <tr th:if="${#lists.isEmpty(loans)}">
                            <td colspan="5" class="text-center text-muted fst-italic py-3">
                                Nenhum livro emprestado no momento.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

    </div>
</div>

</body>
</html>